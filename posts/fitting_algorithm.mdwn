

An EM approach seems promising. In the expectation step, we compute
the probability of any particular combination of states at either end
of an edge in a tree. The appendix of Siepel and Haussler 2010 shows
how to do this. In the M step, we use a quasi-Newton method to update
the rate estimates. Then, we use coordinate descent to update
regression cooefficients for linear predictors of the rates, possibly
with an L-1 penalty.

When the number of jumps is low, it might increase efficiency to
approximate the transition probabilities with a mixture of multinomial
distributions.



